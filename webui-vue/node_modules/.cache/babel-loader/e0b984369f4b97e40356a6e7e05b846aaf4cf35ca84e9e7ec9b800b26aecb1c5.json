{"ast":null,"code":"import { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, createVNode as _createVNode, createTextVNode as _createTextVNode, normalizeClass as _normalizeClass, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-eef61b86\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"col-form-label\"\n};\nconst _hoisted_2 = {\n  class: \"mb-2\",\n  sm: \"6\",\n  md: \"6\"\n};\nconst _hoisted_3 = {\n  class: \"d-inline font-weight-bold mr-1\"\n};\nconst _hoisted_4 = {\n  class: \"d-inline\"\n};\nconst _hoisted_5 = {\n  id: \"terminal\",\n  ref: \"panel\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_alert = _resolveComponent(\"alert\");\n  const _component_b_col = _resolveComponent(\"b-col\");\n  const _component_b_row = _resolveComponent(\"b-row\");\n  const _component_status_icon = _resolveComponent(\"status-icon\");\n  const _component_icon_launch = _resolveComponent(\"icon-launch\");\n  const _component_b_button = _resolveComponent(\"b-button\");\n  return _openBlock(), _createElementBlock(\"div\", {\n    class: _normalizeClass($props.isFullWindow ? 'full-window-container' : 'terminal-container')\n  }, [_createVNode(_component_b_row, {\n    class: \"d-flex\"\n  }, {\n    default: _withCtx(() => [_createVNode(_component_b_col, {\n      sm: \"4\",\n      md: \"6\"\n    }, {\n      default: _withCtx(() => [($options.connection ? false : true) ? (_openBlock(), _createBlock(_component_alert, {\n        key: 0,\n        variant: \"warning\",\n        small: true,\n        class: \"mt-4\"\n      }, {\n        default: _withCtx(() => [_createElementVNode(\"p\", _hoisted_1, _toDisplayString($data.$t('pageSerialOverLan.alert.disconnectedAlertMessage')), 1 /* TEXT */)], undefined, true),\n        _: 1 /* STABLE */\n      })) : _createCommentVNode(\"v-if\", true)], undefined, true),\n      _: 1 /* STABLE */\n    })], undefined, true),\n    _: 1 /* STABLE */\n  }), _createVNode(_component_b_row, {\n    class: \"d-flex\"\n  }, {\n    default: _withCtx(() => [_createVNode(_component_b_col, {\n      class: \"d-flex flex-column justify-content-end\"\n    }, {\n      default: _withCtx(() => [_createElementVNode(\"dl\", _hoisted_2, [_createElementVNode(\"dt\", _hoisted_3, _toDisplayString($data.$t('pageSerialOverLan.status')) + \": \", 1 /* TEXT */), _createElementVNode(\"dd\", _hoisted_4, [_createVNode(_component_status_icon, {\n        status: $options.serverStatusIcon\n      }, null, 8 /* PROPS */, [\"status\"]), _createTextVNode(\" \" + _toDisplayString($options.connection ? $data.$t('pageSerialOverLan.connected') : $data.$t('pageSerialOverLan.disconnected')), 1 /* TEXT */)])])], undefined, true),\n      _: 1 /* STABLE */\n    }), !$props.isFullWindow ? (_openBlock(), _createBlock(_component_b_col, {\n      key: 0,\n      class: \"d-flex justify-content-end\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_b_button, {\n        variant: \"link\",\n        type: \"button\",\n        onClick: _cache[0] || (_cache[0] = $event => $options.openConsoleWindow())\n      }, {\n        default: _withCtx(() => [_createVNode(_component_icon_launch), _createTextVNode(\" \" + _toDisplayString($data.$t('pageSerialOverLan.openNewTab')), 1 /* TEXT */)], undefined, true),\n        _: 1 /* STABLE */\n      })], undefined, true),\n      _: 1 /* STABLE */\n    })) : _createCommentVNode(\"v-if\", true)], undefined, true),\n    _: 1 /* STABLE */\n  }), _createElementVNode(\"div\", _hoisted_5, null, 512 /* NEED_PATCH */)], 2 /* CLASS */);\n}","map":{"version":3,"names":["class","sm","md","id","ref","_createElementBlock","_normalizeClass","$props","isFullWindow","_createVNode","_component_b_row","default","_withCtx","_component_b_col","$options","connection","_createBlock","_component_alert","key","variant","small","_createElementVNode","_hoisted_1","_toDisplayString","$data","$t","_","_createCommentVNode","_hoisted_2","_hoisted_3","_hoisted_4","_component_status_icon","status","serverStatusIcon","_createTextVNode","_component_b_button","type","onClick","_cache","$event","openConsoleWindow","_component_icon_launch","_hoisted_5"],"sources":["/home/zenchenko/openbmc/build/evb-ast2500/workspace/sources/webui-vue/src/views/Operations/SerialOverLan/SerialOverLanConsole.vue"],"sourcesContent":["<template>\n  <div :class=\"isFullWindow ? 'full-window-container' : 'terminal-container'\">\n    <b-row class=\"d-flex\">\n      <b-col sm=\"4\" md=\"6\">\n        <alert\n          v-if=\"connection ? false : true\"\n          variant=\"warning\"\n          :small=\"true\"\n          class=\"mt-4\"\n        >\n          <p class=\"col-form-label\">\n            {{ $t('pageSerialOverLan.alert.disconnectedAlertMessage') }}\n          </p>\n        </alert>\n      </b-col>\n    </b-row>\n    <b-row class=\"d-flex\">\n      <b-col class=\"d-flex flex-column justify-content-end\">\n        <dl class=\"mb-2\" sm=\"6\" md=\"6\">\n          <dt class=\"d-inline font-weight-bold mr-1\">\n            {{ $t('pageSerialOverLan.status') }}:\n          </dt>\n          <dd class=\"d-inline\">\n            <status-icon :status=\"serverStatusIcon\" />\n            {{\n              connection\n                ? $t('pageSerialOverLan.connected')\n                : $t('pageSerialOverLan.disconnected')\n            }}\n          </dd>\n        </dl>\n      </b-col>\n\n      <b-col v-if=\"!isFullWindow\" class=\"d-flex justify-content-end\">\n        <b-button variant=\"link\" type=\"button\" @click=\"openConsoleWindow()\">\n          <icon-launch />\n          {{ $t('pageSerialOverLan.openNewTab') }}\n        </b-button>\n      </b-col>\n    </b-row>\n    <div id=\"terminal\" ref=\"panel\"></div>\n  </div>\n</template>\n\n<script>\nimport Alert from '@/components/Global/Alert';\nimport { AttachAddon } from 'xterm-addon-attach';\nimport { FitAddon } from 'xterm-addon-fit';\nimport { Terminal } from 'xterm';\nimport { throttle } from 'lodash';\nimport IconLaunch from '@carbon/icons-vue/es/launch/20';\nimport StatusIcon from '@/components/Global/StatusIcon';\nimport { useI18n } from 'vue-i18n';\n\nexport default {\n  name: 'SerialOverLanConsole',\n  components: {\n    Alert,\n    IconLaunch,\n    StatusIcon,\n  },\n  props: {\n    isFullWindow: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  data() {\n    return {\n      $t: useI18n().t,\n      resizeConsoleWindow: null,\n    };\n  },\n  computed: {\n    serverStatus() {\n      return this.$store.getters['global/serverStatus'];\n    },\n    connection() {\n      return this.serverStatus === 'off' ? false : true;\n    },\n    serverStatusIcon() {\n      return this.connection ? 'success' : 'danger';\n    },\n  },\n  created() {\n    this.$store.dispatch('global/getSystemInfo');\n  },\n  mounted() {\n    this.openTerminal();\n  },\n  beforeUnmount() {\n    window.removeEventListener('resize', this.resizeConsoleWindow);\n    this.closeTerminal();\n  },\n  methods: {\n    openTerminal() {\n      const token = this.$store.getters['authentication/token'];\n      this.ws = new WebSocket(`wss://${window.location.host}/console/default`, [\n        token,\n      ]);\n\n      // Refer https://github.com/xtermjs/xterm.js/ for xterm implementation and addons.\n\n      this.term = new Terminal({\n        fontSize: 15,\n        fontFamily:\n          'SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, Courier New, monospace',\n      });\n\n      const attachAddon = new AttachAddon(this.ws);\n      this.term.loadAddon(attachAddon);\n\n      const fitAddon = new FitAddon();\n      this.term.loadAddon(fitAddon);\n\n      const SOL_THEME = {\n        background: '#19273c',\n        cursor: 'rgba(83, 146, 255, .5)',\n        scrollbar: 'rgba(83, 146, 255, .5)',\n      };\n      this.term.setOption('theme', SOL_THEME);\n\n      this.term.open(this.$refs.panel);\n      fitAddon.fit();\n\n      this.resizeConsoleWindow = throttle(() => {\n        fitAddon.fit();\n      }, 1000);\n      window.addEventListener('resize', this.resizeConsoleWindow);\n\n      try {\n        this.ws.onopen = function () {\n          console.log('websocket console/default opened');\n        };\n        this.ws.onclose = function (event) {\n          console.log(\n            'websocket console/default closed. code: ' +\n              event.code +\n              ' reason: ' +\n              event.reason,\n          );\n        };\n      } catch (error) {\n        console.log(error);\n      }\n    },\n    closeTerminal() {\n      console.log('closeTerminal');\n      this.term.dispose();\n      this.term = null;\n      this.ws.close();\n      this.ws = null;\n    },\n    openConsoleWindow() {\n      window.open(\n        '#/console/serial-over-lan-console',\n        '_blank',\n        'directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=yes,width=600,height=550',\n      );\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n@import '@/assets/styles/bmc/helpers/_index.scss';\n@import '@/assets/styles/bootstrap/_helpers.scss';\n\n@import '~xterm/css/xterm.css';\n\n#terminal {\n  overflow: auto;\n}\n\n.full-window-container {\n  width: 97%;\n  margin: 1.5%;\n}\n</style>\n"],"mappings":";;;EAUaA,KAAK,EAAC;AAAgB;;EAQvBA,KAAK,EAAC,MAAM;EAACC,EAAE,EAAC,GAAG;EAACC,EAAE,EAAC;;;EACrBF,KAAK,EAAC;AAAgC;;EAGtCA,KAAK,EAAC;AAAU;;EAkBrBG,EAAE,EAAC,UAAU;EAACC,GAAG,EAAC;;;;;;;;;uBAvCzBC,mBAAA,CAwCM;IAxCAL,KAAK,EADbM,eAAA,CACeC,MAAA,CAAAC,YAAY;MACvBC,YAAA,CAaQC,gBAAA;IAbDV,KAAK,EAAC;EAAQ;IAFzBW,OAAA,EAAAC,QAAA,CAGM,MAWQ,CAXRH,YAAA,CAWQI,gBAAA;MAXDZ,EAAE,EAAC,GAAG;MAACC,EAAE,EAAC;;MAHvBS,OAAA,EAAAC,QAAA,CAIQ,MASQ,C,CARAE,QAAA,CAAAC,UAAU,oB,cADlBC,YAAA,CASQC,gBAAA;QAbhBC,GAAA;QAMUC,OAAO,EAAC,SAAS;QAChBC,KAAK,EAAE,IAAI;QACZpB,KAAK,EAAC;;QARhBW,OAAA,EAAAC,QAAA,CAUU,MAEI,CAFJS,mBAAA,CAEI,KAFJC,UAEI,EAAAC,gBAAA,CADCC,KAAA,CAAAC,EAAE,qE;QAXjBC,CAAA;YAAAC,mBAAA,e;MAAAD,CAAA;;IAAAA,CAAA;MAgBIjB,YAAA,CAuBQC,gBAAA;IAvBDV,KAAK,EAAC;EAAQ;IAhBzBW,OAAA,EAAAC,QAAA,CAiBM,MAcQ,CAdRH,YAAA,CAcQI,gBAAA;MAdDb,KAAK,EAAC;IAAwC;MAjB3DW,OAAA,EAAAC,QAAA,CAkBQ,MAYK,CAZLS,mBAAA,CAYK,MAZLO,UAYK,GAXHP,mBAAA,CAEK,MAFLQ,UAEK,EAAAN,gBAAA,CADAC,KAAA,CAAAC,EAAE,gCAA+B,IACtC,iBACAJ,mBAAA,CAOK,MAPLS,UAOK,GANHrB,YAAA,CAA0CsB,sBAAA;QAA5BC,MAAM,EAAElB,QAAA,CAAAmB;MAAgB,qCAvBlDC,gBAAA,CAuBsD,GAC1C,GAAAX,gBAAA,CACET,QAAA,CAAAC,UAAU,GAAmBS,KAAA,CAAAC,EAAE,kCAAkDD,KAAA,CAAAC,EAAE,mD;MAzBjGC,CAAA;SAiCoBnB,MAAA,CAAAC,YAAY,I,cAA1BQ,YAAA,CAKQH,gBAAA;MAtCdK,GAAA;MAiCkClB,KAAK,EAAC;;MAjCxCW,OAAA,EAAAC,QAAA,CAkCQ,MAGW,CAHXH,YAAA,CAGW0B,mBAAA;QAHDhB,OAAO,EAAC,MAAM;QAACiB,IAAI,EAAC,QAAQ;QAAEC,OAAK,EAAAC,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAAEzB,QAAA,CAAA0B,iBAAiB;;QAlCxE7B,OAAA,EAAAC,QAAA,CAmCU,MAAe,CAAfH,YAAA,CAAegC,sBAAA,GAnCzBP,gBAAA,CAmCyB,GACf,GAAAX,gBAAA,CAAGC,KAAA,CAAAC,EAAE,iD;QApCfC,CAAA;;MAAAA,CAAA;UAAAC,mBAAA,e;IAAAD,CAAA;MAwCIL,mBAAA,CAAqC,OAArCqB,UAAqC,8B","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}