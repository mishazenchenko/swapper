{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, withModifiers as _withModifiers, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"form-background p-3\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_b_form_invalid_feedback = _resolveComponent(\"b-form-invalid-feedback\");\n  const _component_form_file = _resolveComponent(\"form-file\");\n  const _component_b_form_group = _resolveComponent(\"b-form-group\");\n  const _component_b_btn = _resolveComponent(\"b-btn\");\n  const _component_b_form = _resolveComponent(\"b-form\");\n  const _component_modal_update_firmware = _resolveComponent(\"modal-update-firmware\");\n  return _openBlock(), _createElementBlock(\"div\", null, [_createElementVNode(\"div\", _hoisted_1, [_createVNode(_component_b_form, {\n    onSubmit: _withModifiers($options.onSubmitUpload, [\"prevent\"])\n  }, {\n    default: _withCtx(() => [_createCommentVNode(\" Workstation Upload \"), _createVNode(_component_b_form_group, {\n      label: $data.$t('pageFirmware.form.updateFirmware.imageFile'),\n      \"label-for\": \"image-file\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_form_file, {\n        id: \"image-file\",\n        disabled: $props.isPageDisabled,\n        state: _ctx.getValidationState($setup.v$.file),\n        \"aria-describedby\": \"image-file-help-block\",\n        onInput: _cache[0] || (_cache[0] = $event => $options.onFileUpload($event))\n      }, {\n        invalid: _withCtx(() => [_createVNode(_component_b_form_invalid_feedback, {\n          role: \"alert\"\n        }, {\n          default: _withCtx(() => [_createTextVNode(_toDisplayString($data.$t('global.form.required')), 1 /* TEXT */)], undefined, true),\n          _: 1 /* STABLE */\n        })]),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"disabled\", \"state\"])], undefined, true),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"label\"]), _createVNode(_component_b_btn, {\n      \"data-test-id\": \"firmware-button-startUpdate\",\n      type: \"submit\",\n      variant: \"primary\",\n      disabled: $props.isPageDisabled\n    }, {\n      default: _withCtx(() => [_createTextVNode(_toDisplayString($data.$t('pageFirmware.form.updateFirmware.startUpdate')), 1 /* TEXT */)], undefined, true),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"disabled\"])], undefined, true),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"onSubmit\"])]), _createCommentVNode(\" Modals \"), _createVNode(_component_modal_update_firmware, {\n    onOk: $options.updateFirmware\n  }, null, 8 /* PROPS */, [\"onOk\"])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_createElementVNode","_hoisted_1","_createVNode","_component_b_form","onSubmit","_withModifiers","$options","onSubmitUpload","default","_withCtx","_createCommentVNode","_component_b_form_group","label","$data","$t","_component_form_file","id","disabled","$props","isPageDisabled","state","_ctx","getValidationState","$setup","v$","file","onInput","_cache","$event","onFileUpload","invalid","_component_b_form_invalid_feedback","role","_createTextVNode","_toDisplayString","_","_component_b_btn","type","variant","_component_modal_update_firmware","onOk","updateFirmware"],"sources":["/home/zenchenko/openbmc/build/evb-ast2500/workspace/sources/webui-vue/src/views/Operations/Firmware/FirmwareFormUpdate.vue"],"sourcesContent":["<template>\n  <div>\n    <div class=\"form-background p-3\">\n      <b-form @submit.prevent=\"onSubmitUpload\">\n        <!-- Workstation Upload -->\n        <template>\n          <b-form-group\n            :label=\"$t('pageFirmware.form.updateFirmware.imageFile')\"\n            label-for=\"image-file\"\n          >\n            <form-file\n              id=\"image-file\"\n              :disabled=\"isPageDisabled\"\n              :state=\"getValidationState(v$.file)\"\n              aria-describedby=\"image-file-help-block\"\n              @input=\"onFileUpload($event)\"\n            >\n              <template #invalid>\n                <b-form-invalid-feedback role=\"alert\">\n                  {{ $t('global.form.required') }}\n                </b-form-invalid-feedback>\n              </template>\n            </form-file>\n          </b-form-group>\n        </template>\n\n        <b-btn\n          data-test-id=\"firmware-button-startUpdate\"\n          type=\"submit\"\n          variant=\"primary\"\n          :disabled=\"isPageDisabled\"\n        >\n          {{ $t('pageFirmware.form.updateFirmware.startUpdate') }}\n        </b-btn>\n      </b-form>\n    </div>\n\n    <!-- Modals -->\n    <modal-update-firmware @ok=\"updateFirmware\" />\n  </div>\n</template>\n\n<script>\nimport { required } from 'vuelidate/lib/validators';\n\nimport BVToastMixin from '@/components/Mixins/BVToastMixin';\nimport LoadingBarMixin, { loading } from '@/components/Mixins/LoadingBarMixin';\nimport VuelidateMixin from '@/components/Mixins/VuelidateMixin.js';\nimport { useVuelidate } from '@vuelidate/core';\n\nimport FormFile from '@/components/Global/FormFile';\nimport ModalUpdateFirmware from './FirmwareModalUpdateFirmware';\nimport { useI18n } from 'vue-i18n';\nimport i18n from '@/i18n';\n\nexport default {\n  components: { FormFile, ModalUpdateFirmware },\n  mixins: [BVToastMixin, LoadingBarMixin, VuelidateMixin],\n  props: {\n    isPageDisabled: {\n      required: true,\n      type: Boolean,\n      default: false,\n    },\n    isServerOff: {\n      required: true,\n      type: Boolean,\n    },\n  },\n  setup() {\n    return {\n      v$: useVuelidate(),\n    };\n  },\n  data() {\n    return {\n      $t: useI18n().t,\n      loading,\n      file: null,\n      isServerPowerOffRequired:\n        process.env.VUE_APP_SERVER_OFF_REQUIRED === 'true',\n    };\n  },\n  validations: {\n    file: {\n      required,\n    },\n  },\n  created() {\n    this.$store.dispatch('firmware/getUpdateServiceSettings');\n  },\n  methods: {\n    updateFirmware() {\n      this.startLoader();\n      const timerId = setTimeout(() => {\n        this.endLoader();\n        this.infoToast(\n          i18n.global.t('pageFirmware.toast.verifyUpdateMessage'),\n          {\n            title: i18n.global.t('pageFirmware.toast.verifyUpdate'),\n            refreshAction: true,\n          },\n        );\n      }, 360000);\n      this.infoToast(i18n.global.t('pageFirmware.toast.updateStartedMessage'), {\n        title: i18n.global.t('pageFirmware.toast.updateStarted'),\n        timestamp: true,\n      });\n      this.dispatchWorkstationUpload(timerId);\n    },\n    dispatchWorkstationUpload(timerId) {\n      this.$store\n        .dispatch('firmware/uploadFirmware', {\n          image: this.file,\n        })\n        .catch(({ message }) => {\n          this.endLoader();\n          this.errorToast(message);\n          clearTimeout(timerId);\n        });\n    },\n    onSubmitUpload() {\n      this.v$.$touch();\n      if (this.v$.$invalid) return;\n      this.$bvModal.show('modal-update-firmware');\n    },\n    onFileUpload(file) {\n      this.file = file;\n      this.v$.file.$touch();\n    },\n  },\n};\n</script>\n"],"mappings":";;EAESA,KAAK,EAAC;AAAqB;;;;;;;;uBADlCC,mBAAA,CAsCM,cArCJC,mBAAA,CAiCM,OAjCNC,UAiCM,GAhCJC,YAAA,CA+BSC,iBAAA;IA/BAC,QAAM,EAHrBC,cAAA,CAG+BC,QAAA,CAAAC,cAAc;;IAH7CC,OAAA,EAAAC,QAAA,CAIQ,MAA2B,CAA3BC,mBAAA,wBAA2B,EAEzBR,YAAA,CAiBeS,uBAAA;MAhBZC,KAAK,EAAEC,KAAA,CAAAC,EAAE;MACV,WAAS,EAAC;;MARtBN,OAAA,EAAAC,QAAA,CAUY,MAYY,CAZZP,YAAA,CAYYa,oBAAA;QAXVC,EAAE,EAAC,YAAY;QACdC,QAAQ,EAAEC,MAAA,CAAAC,cAAc;QACxBC,KAAK,EAAEC,IAAA,CAAAC,kBAAkB,CAACC,MAAA,CAAAC,EAAE,CAACC,IAAI;QAClC,kBAAgB,EAAC,uBAAuB;QACvCC,OAAK,EAAAC,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAAEtB,QAAA,CAAAuB,YAAY,CAACD,MAAM;;QAEhBE,OAAO,EAAArB,QAAA,CAChB,MAE0B,CAF1BP,YAAA,CAE0B6B,kCAAA;UAFDC,IAAI,EAAC;QAAO;UAlBrDxB,OAAA,EAAAC,QAAA,CAmBkB,MAAgC,CAnBlDwB,gBAAA,CAAAC,gBAAA,CAmBqBrB,KAAA,CAAAC,EAAE,yC;UAnBvBqB,CAAA;;QAAAA,CAAA;;MAAAA,CAAA;kCA0BQjC,YAAA,CAOQkC,gBAAA;MANN,cAAY,EAAC,6BAA6B;MAC1CC,IAAI,EAAC,QAAQ;MACbC,OAAO,EAAC,SAAS;MAChBrB,QAAQ,EAAEC,MAAA,CAAAC;;MA9BrBX,OAAA,EAAAC,QAAA,CAgCU,MAAwD,CAhClEwB,gBAAA,CAAAC,gBAAA,CAgCarB,KAAA,CAAAC,EAAE,iE;MAhCfqB,CAAA;;IAAAA,CAAA;qCAqCIzB,mBAAA,YAAe,EACfR,YAAA,CAA8CqC,gCAAA;IAAtBC,IAAE,EAAElC,QAAA,CAAAmC;EAAc,kC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}