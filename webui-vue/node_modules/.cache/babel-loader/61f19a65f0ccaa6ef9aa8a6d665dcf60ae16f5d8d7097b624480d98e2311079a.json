{"ast":null,"code":"import { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, createTextVNode as _createTextVNode, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, normalizeClass as _normalizeClass, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-060237db\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  ref: \"toolbar\",\n  class: \"kvm-toolbar\"\n};\nconst _hoisted_2 = {\n  class: \"mb-2\",\n  sm: \"2\",\n  md: \"2\"\n};\nconst _hoisted_3 = {\n  class: \"d-inline font-weight-bold mr-1\"\n};\nconst _hoisted_4 = {\n  class: \"d-inline\"\n};\nconst _hoisted_5 = {\n  class: \"d-none d-md-inline\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_status_icon = _resolveComponent(\"status-icon\");\n  const _component_b_col = _resolveComponent(\"b-col\");\n  const _component_icon_arrow_down = _resolveComponent(\"icon-arrow-down\");\n  const _component_b_button = _resolveComponent(\"b-button\");\n  const _component_icon_launch = _resolveComponent(\"icon-launch\");\n  const _component_b_row = _resolveComponent(\"b-row\");\n  return _openBlock(), _createElementBlock(\"div\", {\n    class: _normalizeClass($data.marginClass)\n  }, [_createElementVNode(\"div\", _hoisted_1, [_createVNode(_component_b_row, {\n    class: \"d-flex\"\n  }, {\n    default: _withCtx(() => [_createVNode(_component_b_col, {\n      class: \"d-flex flex-column justify-content-end\",\n      cols: \"4\"\n    }, {\n      default: _withCtx(() => [_createElementVNode(\"dl\", _hoisted_2, [_createElementVNode(\"dt\", _hoisted_3, _toDisplayString($data.$t('pageKvm.status')) + \": \", 1 /* TEXT */), _createElementVNode(\"dd\", _hoisted_4, [_createVNode(_component_status_icon, {\n        status: $options.serverStatusIcon\n      }, null, 8 /* PROPS */, [\"status\"]), _createElementVNode(\"span\", _hoisted_5, _toDisplayString($options.serverStatus), 1 /* TEXT */)])])], undefined, true),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_b_col, {\n      class: \"d-flex justify-content-end pr-1\"\n    }, {\n      default: _withCtx(() => [$data.isConnected ? (_openBlock(), _createBlock(_component_b_button, {\n        key: 0,\n        variant: \"link\",\n        type: \"button\",\n        onClick: $options.sendCtrlAltDel\n      }, {\n        default: _withCtx(() => [_createVNode(_component_icon_arrow_down), _createTextVNode(\" \" + _toDisplayString($data.$t('pageKvm.buttonCtrlAltDelete')), 1 /* TEXT */)], undefined, true),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"onClick\"])) : _createCommentVNode(\"v-if\", true), !$props.isFullWindow ? (_openBlock(), _createBlock(_component_b_button, {\n        key: 1,\n        variant: \"link\",\n        type: \"button\",\n        onClick: _cache[0] || (_cache[0] = $event => $options.openConsoleWindow())\n      }, {\n        default: _withCtx(() => [_createVNode(_component_icon_launch), _createTextVNode(\" \" + _toDisplayString($data.$t('pageKvm.openNewTab')), 1 /* TEXT */)], undefined, true),\n        _: 1 /* STABLE */\n      })) : _createCommentVNode(\"v-if\", true)], undefined, true),\n      _: 1 /* STABLE */\n    })], undefined, true),\n    _: 1 /* STABLE */\n  })], 512 /* NEED_PATCH */), _createElementVNode(\"div\", {\n    id: \"terminal-kvm\",\n    ref: \"panel\",\n    class: _normalizeClass($data.terminalClass)\n  }, null, 2 /* CLASS */)], 2 /* CLASS */);\n}","map":{"version":3,"names":["ref","class","sm","md","_createElementBlock","_normalizeClass","$data","marginClass","_createElementVNode","_hoisted_1","_createVNode","_component_b_row","default","_withCtx","_component_b_col","cols","_hoisted_2","_hoisted_3","_toDisplayString","$t","_hoisted_4","_component_status_icon","status","$options","serverStatusIcon","_hoisted_5","serverStatus","_","isConnected","_createBlock","_component_b_button","key","variant","type","onClick","sendCtrlAltDel","_component_icon_arrow_down","_createTextVNode","_createCommentVNode","$props","isFullWindow","_cache","$event","openConsoleWindow","_component_icon_launch","id","terminalClass"],"sources":["/home/zenchenko/openbmc/build/evb-ast2500/workspace/sources/webui-vue/src/views/Operations/Kvm/KvmConsole.vue"],"sourcesContent":["<template>\n  <div :class=\"marginClass\">\n    <div ref=\"toolbar\" class=\"kvm-toolbar\">\n      <b-row class=\"d-flex\">\n        <b-col class=\"d-flex flex-column justify-content-end\" cols=\"4\">\n          <dl class=\"mb-2\" sm=\"2\" md=\"2\">\n            <dt class=\"d-inline font-weight-bold mr-1\">\n              {{ $t('pageKvm.status') }}:\n            </dt>\n            <dd class=\"d-inline\">\n              <status-icon :status=\"serverStatusIcon\" />\n              <span class=\"d-none d-md-inline\"> {{ serverStatus }}</span>\n            </dd>\n          </dl>\n        </b-col>\n\n        <b-col class=\"d-flex justify-content-end pr-1\">\n          <b-button\n            v-if=\"isConnected\"\n            variant=\"link\"\n            type=\"button\"\n            @click=\"sendCtrlAltDel\"\n          >\n            <icon-arrow-down />\n            {{ $t('pageKvm.buttonCtrlAltDelete') }}\n          </b-button>\n          <b-button\n            v-if=\"!isFullWindow\"\n            variant=\"link\"\n            type=\"button\"\n            @click=\"openConsoleWindow()\"\n          >\n            <icon-launch />\n            {{ $t('pageKvm.openNewTab') }}\n          </b-button>\n        </b-col>\n      </b-row>\n    </div>\n    <div id=\"terminal-kvm\" ref=\"panel\" :class=\"terminalClass\"></div>\n  </div>\n</template>\n\n<script>\nimport RFB from '@novnc/novnc/core/rfb';\nimport StatusIcon from '@/components/Global/StatusIcon';\nimport IconLaunch from '@carbon/icons-vue/es/launch/20';\nimport IconArrowDown from '@carbon/icons-vue/es/arrow--down/16';\nimport { throttle } from 'lodash';\nimport { useI18n } from 'vue-i18n';\nimport i18n from '@/i18n';\n\nconst Connecting = 0;\nconst Connected = 1;\nconst Disconnected = 2;\n\nexport default {\n  name: 'KvmConsole',\n  components: { StatusIcon, IconLaunch, IconArrowDown },\n  props: {\n    isFullWindow: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  data() {\n    return {\n      $t: useI18n().t,\n      rfb: null,\n      isConnected: false,\n      terminalClass: this.isFullWindow ? 'full-window' : '',\n      marginClass: this.isFullWindow ? 'margin-left-full-window' : '',\n      status: Connecting,\n      convasRef: null,\n      resizeKvmWindow: null,\n    };\n  },\n  computed: {\n    serverStatusIcon() {\n      if (this.status === Connected) {\n        return 'success';\n      } else if (this.status === Disconnected) {\n        return 'danger';\n      }\n      return 'secondary';\n    },\n    serverStatus() {\n      if (this.status === Connected) {\n        return i18n.global.t('pageKvm.connected');\n      } else if (this.status === Disconnected) {\n        return i18n.global.t('pageKvm.disconnected');\n      }\n      return i18n.global.t('pageKvm.connecting');\n    },\n  },\n  created() {\n    this.$store.dispatch('global/getSystemInfo');\n  },\n  mounted() {\n    this.openTerminal();\n  },\n  beforeUnmount() {\n    window.removeEventListener('resize', this.resizeKvmWindow);\n    this.closeTerminal();\n  },\n  methods: {\n    sendCtrlAltDel() {\n      this.rfb.sendCtrlAltDel();\n    },\n    closeTerminal() {\n      this.rfb.disconnect();\n      this.rfb = null;\n    },\n    openTerminal() {\n      const token = this.$store.getters['authentication/token'];\n      this.rfb = new RFB(\n        this.$refs.panel,\n        `wss://${window.location.host}/kvm/0`,\n        { wsProtocols: [token] },\n      );\n\n      this.rfb.scaleViewport = true;\n      this.rfb.clipViewport = true;\n      const that = this;\n\n      this.resizeKvmWindow = throttle(() => {\n        setTimeout(that.setWidthToolbar, 0);\n      }, 1000);\n      window.addEventListener('resize', this.resizeKvmWindow);\n\n      this.rfb.addEventListener('connect', () => {\n        that.isConnected = true;\n        that.status = Connected;\n        that.setWidthToolbar();\n      });\n\n      this.rfb.addEventListener('disconnect', () => {\n        this.isConnected = false;\n        that.status = Disconnected;\n      });\n    },\n    setWidthToolbar() {\n      if (\n        this.$refs.panel.children &&\n        this.$refs.panel.children.length > 0 &&\n        this.$refs.panel.children[0].children.length > 0\n      ) {\n        this.$refs.toolbar.style.width =\n          this.$refs.panel.children[0].children[0].clientWidth - 10 + 'px';\n      }\n    },\n    openConsoleWindow() {\n      // If consoleWindow is not null\n      // Check the newly opened window is closed or not\n      if (this.$eventBus.$consoleWindow) {\n        // If window is not closed set focus to new window\n        // If window is closed, do open new window\n        if (!this.$eventBus.$consoleWindow.closed) {\n          this.$eventBus.$consoleWindow.focus();\n          return;\n        } else {\n          this.openNewWindow();\n        }\n      } else {\n        // If consoleWindow is null, open new window\n        this.openNewWindow();\n      }\n    },\n    openNewWindow() {\n      this.$eventBus.$consoleWindow = window.open(\n        '#/console/kvm',\n        'kvmConsoleWindow',\n        'directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=yes,width=700,height=550',\n      );\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\">\n@import '@/assets/styles/bmc/custom/_kvm.scss';\n</style>\n\n<style lang=\"scss\" scoped>\n@import '@/assets/styles/bmc/helpers/_index.scss';\n@import '@/assets/styles/bootstrap/_helpers.scss';\n\n.button-ctrl-alt-delete {\n  float: right;\n}\n\n.kvm-status {\n  padding-top: $spacer / 2;\n  padding-left: $spacer / 4;\n  display: inline-block;\n}\n\n.margin-left-full-window {\n  margin-left: 5px;\n}\n</style>\n"],"mappings":";;;EAESA,GAAG,EAAC,SAAS;EAACC,KAAK,EAAC;;;EAGfA,KAAK,EAAC,MAAM;EAACC,EAAE,EAAC,GAAG;EAACC,EAAE,EAAC;;;EACrBF,KAAK,EAAC;AAAgC;;EAGtCA,KAAK,EAAC;AAAU;;EAEZA,KAAK,EAAC;AAAoB;;;;;;;;uBAV5CG,mBAAA,CAsCM;IAtCAH,KAAK,EADbI,eAAA,CACeC,KAAA,CAAAC,WAAW;MACtBC,mBAAA,CAmCM,OAnCNC,UAmCM,GAlCJC,YAAA,CAiCQC,gBAAA;IAjCDV,KAAK,EAAC;EAAQ;IAH3BW,OAAA,EAAAC,QAAA,CAIQ,MAUQ,CAVRH,YAAA,CAUQI,gBAAA;MAVDb,KAAK,EAAC,wCAAwC;MAACc,IAAI,EAAC;;MAJnEH,OAAA,EAAAC,QAAA,CAKU,MAQK,CARLL,mBAAA,CAQK,MARLQ,UAQK,GAPHR,mBAAA,CAEK,MAFLS,UAEK,EAAAC,gBAAA,CADAZ,KAAA,CAAAa,EAAE,sBAAqB,IAC5B,iBACAX,mBAAA,CAGK,MAHLY,UAGK,GAFHV,YAAA,CAA0CW,sBAAA;QAA5BC,MAAM,EAAEC,QAAA,CAAAC;MAAgB,qCACtChB,mBAAA,CAA2D,QAA3DiB,UAA2D,EAAAP,gBAAA,CAAtBK,QAAA,CAAAG,YAAY,iB;MAX/DC,CAAA;QAgBQjB,YAAA,CAmBQI,gBAAA;MAnBDb,KAAK,EAAC;IAAiC;MAhBtDW,OAAA,EAAAC,QAAA,CAiBU,MAQW,CAPHP,KAAA,CAAAsB,WAAW,I,cADnBC,YAAA,CAQWC,mBAAA;QAzBrBC,GAAA;QAmBYC,OAAO,EAAC,MAAM;QACdC,IAAI,EAAC,QAAQ;QACZC,OAAK,EAAEX,QAAA,CAAAY;;QArBpBvB,OAAA,EAAAC,QAAA,CAuBY,MAAmB,CAAnBH,YAAA,CAAmB0B,0BAAA,GAvB/BC,gBAAA,CAuB+B,GACnB,GAAAnB,gBAAA,CAAGZ,KAAA,CAAAa,EAAE,gD;QAxBjBQ,CAAA;wCAAAW,mBAAA,gB,CA2BmBC,MAAA,CAAAC,YAAY,I,cADrBX,YAAA,CAQWC,mBAAA;QAlCrBC,GAAA;QA4BYC,OAAO,EAAC,MAAM;QACdC,IAAI,EAAC,QAAQ;QACZC,OAAK,EAAAO,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAAEnB,QAAA,CAAAoB,iBAAiB;;QA9BrC/B,OAAA,EAAAC,QAAA,CAgCY,MAAe,CAAfH,YAAA,CAAekC,sBAAA,GAhC3BP,gBAAA,CAgC2B,GACf,GAAAnB,gBAAA,CAAGZ,KAAA,CAAAa,EAAE,uC;QAjCjBQ,CAAA;YAAAW,mBAAA,e;MAAAX,CAAA;;IAAAA,CAAA;8BAsCInB,mBAAA,CAAgE;IAA3DqC,EAAE,EAAC,cAAc;IAAC7C,GAAG,EAAC,OAAO;IAAEC,KAAK,EAtC7CI,eAAA,CAsC+CC,KAAA,CAAAwC,aAAa","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}