{"ast":null,"code":"import PageTitle from '@/components/Global/PageTitle';\nimport PageSection from '@/components/Global/PageSection';\nimport BVToastMixin from '@/components/Mixins/BVToastMixin';\nimport LoadingBarMixin from '@/components/Mixins/LoadingBarMixin';\nimport ModalConfigureConnection from './ModalConfigureConnection';\nimport NbdServer from '@/utilities/NBDServer';\nimport FormFile from '@/components/Global/FormFile';\nimport { useI18n } from 'vue-i18n';\nimport i18n from '@/i18n';\nexport default {\n  name: 'VirtualMedia',\n  components: {\n    PageTitle,\n    PageSection,\n    ModalConfigureConnection,\n    FormFile\n  },\n  mixins: [BVToastMixin, LoadingBarMixin],\n  data() {\n    return {\n      $t: useI18n().t,\n      modalConfigureConnection: null,\n      loadImageFromExternalServer: process.env.VUE_APP_VIRTUAL_MEDIA_LIST_ENABLED === 'true' ? true : false\n    };\n  },\n  computed: {\n    proxyDevices() {\n      return this.$store.getters['virtualMedia/proxyDevices'];\n    },\n    legacyDevices() {\n      return this.$store.getters['virtualMedia/legacyDevices'];\n    }\n  },\n  created() {\n    this.$store.dispatch('global/getSystemInfo');\n    if (this.proxyDevices.length > 0 || this.legacyDevices.length > 0) return;\n    this.startLoader();\n    this.$store.dispatch('virtualMedia/getData').finally(() => this.endLoader());\n  },\n  methods: {\n    startVM(device) {\n      const token = this.$store.getters['authentication/token'];\n      device.nbd = new NbdServer(`wss://${window.location.host}${device.websocket}`, device.file, device.id, token);\n      device.nbd.socketStarted = () => this.successToast(i18n.global.t('pageVirtualMedia.toast.serverRunning'));\n      device.nbd.errorReadingFile = () => this.errorToast(i18n.global.t('pageVirtualMedia.toast.errorReadingFile'));\n      device.nbd.socketClosed = code => {\n        if (code === 1000) this.successToast(i18n.global.t('pageVirtualMedia.toast.serverClosedSuccessfully'));else this.errorToast(i18n.global.t('pageVirtualMedia.toast.serverClosedWithErrors'));\n        device.file = null;\n        device.isActive = false;\n      };\n      device.nbd.start();\n      device.isActive = true;\n    },\n    stopVM(device) {\n      device.nbd.stop();\n    },\n    startLegacy(connectionData) {\n      var data = {};\n      data.Image = connectionData.serverUri;\n      data.UserName = connectionData.username;\n      data.Password = connectionData.password;\n      data.WriteProtected = !connectionData.isRW;\n      this.startLoader();\n      this.$store.dispatch('virtualMedia/mountImage', {\n        id: connectionData.id,\n        data: data\n      }).then(() => {\n        this.successToast(i18n.global.t('pageVirtualMedia.toast.serverConnectionEstablished'));\n        connectionData.isActive = true;\n      }).catch(() => {\n        this.errorToast(i18n.global.t('pageVirtualMedia.toast.errorMounting'));\n        this.isActive = false;\n      }).finally(() => this.endLoader());\n    },\n    stopLegacy(connectionData) {\n      this.$store.dispatch('virtualMedia/unmountImage', connectionData.id).then(() => {\n        this.successToast(i18n.global.t('pageVirtualMedia.toast.serverClosedSuccessfully'));\n        connectionData.isActive = false;\n      }).catch(() => this.errorToast(i18n.global.t('pageVirtualMedia.toast.errorUnmounting'))).finally(() => this.endLoader());\n    },\n    saveConnection(connectionData) {\n      this.modalConfigureConnection.serverUri = connectionData.serverUri;\n      this.modalConfigureConnection.username = connectionData.username;\n      this.modalConfigureConnection.password = connectionData.password;\n      this.modalConfigureConnection.isRW = connectionData.isRW;\n    },\n    configureConnection(connectionData) {\n      this.modalConfigureConnection = connectionData;\n      this.$bvModal.show('configure-connection');\n    },\n    concatId(val) {\n      return val.split(' ').join('_').toLowerCase();\n    }\n  }\n};","map":{"version":3,"names":["PageTitle","PageSection","BVToastMixin","LoadingBarMixin","ModalConfigureConnection","NbdServer","FormFile","useI18n","i18n","name","components","mixins","data","$t","t","modalConfigureConnection","loadImageFromExternalServer","process","env","VUE_APP_VIRTUAL_MEDIA_LIST_ENABLED","computed","proxyDevices","$store","getters","legacyDevices","created","dispatch","length","startLoader","finally","endLoader","methods","startVM","device","token","nbd","window","location","host","websocket","file","id","socketStarted","successToast","global","errorReadingFile","errorToast","socketClosed","code","isActive","start","stopVM","stop","startLegacy","connectionData","Image","serverUri","UserName","username","Password","password","WriteProtected","isRW","then","catch","stopLegacy","saveConnection","configureConnection","$bvModal","show","concatId","val","split","join","toLowerCase"],"sources":["/home/zenchenko/openbmc/build/evb-ast2500/workspace/sources/webui-vue/src/views/Operations/VirtualMedia/VirtualMedia.vue"],"sourcesContent":["<template>\n  <b-container fluid=\"xl\">\n    <page-title />\n    <b-row class=\"mb-4\">\n      <b-col md=\"12\">\n        <page-section\n          :section-title=\"$t('pageVirtualMedia.virtualMediaSubTitleFirst')\"\n        >\n          <b-row>\n            <b-col v-for=\"(dev, $index) in proxyDevices\" :key=\"$index\" md=\"6\">\n              <b-form-group :label=\"dev.id\" label-class=\"bold\">\n                <form-file\n                  v-if=\"!dev.isActive\"\n                  :id=\"concatId(dev.id)\"\n                  v-model=\"dev.file\"\n                >\n                  <template #invalid>\n                    <b-form-invalid-feedback role=\"alert\">\n                      {{ $t('global.form.required') }}\n                    </b-form-invalid-feedback>\n                  </template>\n                </form-file>\n              </b-form-group>\n              <b-button\n                v-if=\"!dev.isActive\"\n                variant=\"primary\"\n                :disabled=\"!dev.file\"\n                @click=\"startVM(dev)\"\n              >\n                {{ $t('pageVirtualMedia.start') }}\n              </b-button>\n              <b-button\n                v-if=\"dev.isActive\"\n                variant=\"primary\"\n                :disabled=\"!dev.file\"\n                @click=\"stopVM(dev)\"\n              >\n                {{ $t('pageVirtualMedia.stop') }}\n              </b-button>\n            </b-col>\n          </b-row>\n        </page-section>\n      </b-col>\n    </b-row>\n    <b-row v-if=\"loadImageFromExternalServer\" class=\"mb-4\">\n      <b-col md=\"12\">\n        <page-section\n          :section-title=\"$t('pageVirtualMedia.virtualMediaSubTitleSecond')\"\n        >\n          <b-row>\n            <b-col\n              v-for=\"(device, $index) in legacyDevices\"\n              :key=\"$index\"\n              md=\"6\"\n            >\n              <b-form-group\n                :label=\"device.id\"\n                :label-for=\"device.id\"\n                label-class=\"bold\"\n              >\n                <b-button\n                  variant=\"primary\"\n                  :disabled=\"device.isActive\"\n                  @click=\"configureConnection(device)\"\n                >\n                  {{ $t('pageVirtualMedia.configureConnection') }}\n                </b-button>\n\n                <b-button\n                  v-if=\"!device.isActive\"\n                  variant=\"primary\"\n                  class=\"float-right\"\n                  :disabled=\"!device.serverUri\"\n                  @click=\"startLegacy(device)\"\n                >\n                  {{ $t('pageVirtualMedia.start') }}\n                </b-button>\n                <b-button\n                  v-if=\"device.isActive\"\n                  variant=\"primary\"\n                  class=\"float-right\"\n                  @click=\"stopLegacy(device)\"\n                >\n                  {{ $t('pageVirtualMedia.stop') }}\n                </b-button>\n              </b-form-group>\n            </b-col>\n          </b-row>\n        </page-section>\n      </b-col>\n    </b-row>\n    <modal-configure-connection\n      :connection=\"modalConfigureConnection\"\n      @ok=\"saveConnection\"\n    />\n  </b-container>\n</template>\n\n<script>\nimport PageTitle from '@/components/Global/PageTitle';\nimport PageSection from '@/components/Global/PageSection';\nimport BVToastMixin from '@/components/Mixins/BVToastMixin';\nimport LoadingBarMixin from '@/components/Mixins/LoadingBarMixin';\nimport ModalConfigureConnection from './ModalConfigureConnection';\nimport NbdServer from '@/utilities/NBDServer';\nimport FormFile from '@/components/Global/FormFile';\nimport { useI18n } from 'vue-i18n';\nimport i18n from '@/i18n';\n\nexport default {\n  name: 'VirtualMedia',\n  components: { PageTitle, PageSection, ModalConfigureConnection, FormFile },\n  mixins: [BVToastMixin, LoadingBarMixin],\n  data() {\n    return {\n      $t: useI18n().t,\n      modalConfigureConnection: null,\n      loadImageFromExternalServer:\n        process.env.VUE_APP_VIRTUAL_MEDIA_LIST_ENABLED === 'true'\n          ? true\n          : false,\n    };\n  },\n  computed: {\n    proxyDevices() {\n      return this.$store.getters['virtualMedia/proxyDevices'];\n    },\n    legacyDevices() {\n      return this.$store.getters['virtualMedia/legacyDevices'];\n    },\n  },\n  created() {\n    this.$store.dispatch('global/getSystemInfo');\n    if (this.proxyDevices.length > 0 || this.legacyDevices.length > 0) return;\n    this.startLoader();\n    this.$store\n      .dispatch('virtualMedia/getData')\n      .finally(() => this.endLoader());\n  },\n  methods: {\n    startVM(device) {\n      const token = this.$store.getters['authentication/token'];\n      device.nbd = new NbdServer(\n        `wss://${window.location.host}${device.websocket}`,\n        device.file,\n        device.id,\n        token,\n      );\n      device.nbd.socketStarted = () =>\n        this.successToast(\n          i18n.global.t('pageVirtualMedia.toast.serverRunning'),\n        );\n      device.nbd.errorReadingFile = () =>\n        this.errorToast(\n          i18n.global.t('pageVirtualMedia.toast.errorReadingFile'),\n        );\n      device.nbd.socketClosed = (code) => {\n        if (code === 1000)\n          this.successToast(\n            i18n.global.t('pageVirtualMedia.toast.serverClosedSuccessfully'),\n          );\n        else\n          this.errorToast(\n            i18n.global.t('pageVirtualMedia.toast.serverClosedWithErrors'),\n          );\n        device.file = null;\n        device.isActive = false;\n      };\n\n      device.nbd.start();\n      device.isActive = true;\n    },\n    stopVM(device) {\n      device.nbd.stop();\n    },\n    startLegacy(connectionData) {\n      var data = {};\n      data.Image = connectionData.serverUri;\n      data.UserName = connectionData.username;\n      data.Password = connectionData.password;\n      data.WriteProtected = !connectionData.isRW;\n      this.startLoader();\n      this.$store\n        .dispatch('virtualMedia/mountImage', {\n          id: connectionData.id,\n          data: data,\n        })\n        .then(() => {\n          this.successToast(\n            i18n.global.t('pageVirtualMedia.toast.serverConnectionEstablished'),\n          );\n          connectionData.isActive = true;\n        })\n        .catch(() => {\n          this.errorToast(\n            i18n.global.t('pageVirtualMedia.toast.errorMounting'),\n          );\n          this.isActive = false;\n        })\n        .finally(() => this.endLoader());\n    },\n    stopLegacy(connectionData) {\n      this.$store\n        .dispatch('virtualMedia/unmountImage', connectionData.id)\n        .then(() => {\n          this.successToast(\n            i18n.global.t('pageVirtualMedia.toast.serverClosedSuccessfully'),\n          );\n          connectionData.isActive = false;\n        })\n        .catch(() =>\n          this.errorToast(\n            i18n.global.t('pageVirtualMedia.toast.errorUnmounting'),\n          ),\n        )\n        .finally(() => this.endLoader());\n    },\n    saveConnection(connectionData) {\n      this.modalConfigureConnection.serverUri = connectionData.serverUri;\n      this.modalConfigureConnection.username = connectionData.username;\n      this.modalConfigureConnection.password = connectionData.password;\n      this.modalConfigureConnection.isRW = connectionData.isRW;\n    },\n    configureConnection(connectionData) {\n      this.modalConfigureConnection = connectionData;\n      this.$bvModal.show('configure-connection');\n    },\n    concatId(val) {\n      return val.split(' ').join('_').toLowerCase();\n    },\n  },\n};\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}