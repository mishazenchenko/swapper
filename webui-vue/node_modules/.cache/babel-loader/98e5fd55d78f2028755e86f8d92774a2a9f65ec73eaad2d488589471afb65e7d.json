{"ast":null,"code":"import api from '@/store/api';\nimport i18n from '@/i18n';\nconst PowerControlStore = {\n  namespaced: true,\n  state: {\n    powerCapValue: null,\n    powerCapUri: '',\n    powerConsumptionValue: null\n  },\n  getters: {\n    powerCapValue: state => state.powerCapValue,\n    powerCapUri: state => state.powerCapUri,\n    powerConsumptionValue: state => state.powerConsumptionValue\n  },\n  mutations: {\n    setPowerCapValue: (state, powerCapValue) => state.powerCapValue = powerCapValue,\n    setPowerCapUri: (state, powerCapUri) => state.powerCapUri = powerCapUri,\n    setPowerConsumptionValue: (state, powerConsumptionValue) => state.powerConsumptionValue = powerConsumptionValue\n  },\n  actions: {\n    setPowerCapUpdatedValue({\n      commit\n    }, value) {\n      commit('setPowerCapValue', value);\n    },\n    async getChassisCollection() {\n      return await api.get('/redfish/v1/').then(response => api.get(response.data.Chassis['@odata.id'])).then(({\n        data: {\n          Members\n        }\n      }) => Members.map(member => member['@odata.id'])).catch(error => console.log(error));\n    },\n    async getPowerControl({\n      dispatch,\n      commit\n    }) {\n      const collection = await dispatch('getChassisCollection');\n      if (!collection || collection.length === 0) return;\n      return await api.get(`${collection[0]}`).then(response => api.get(response.data.Power['@odata.id'])).then(response => {\n        const powerControl = response.data.PowerControl;\n        if (!powerControl || powerControl.length === 0) return;\n        const powerCapUri = response.data['@odata.id'];\n        const powerCap = powerControl[0].PowerLimit.LimitInWatts;\n        // If system is powered off, power consumption does not exist in the PowerControl\n        const powerConsumption = powerControl[0].PowerConsumedWatts || null;\n        commit('setPowerCapUri', powerCapUri);\n        commit('setPowerCapValue', powerCap);\n        commit('setPowerConsumptionValue', powerConsumption);\n      }).catch(error => {\n        console.log('Power control', error);\n      });\n    },\n    async setPowerControl({\n      state\n    }, powerCapValue) {\n      const data = {\n        PowerControl: [{\n          PowerLimit: {\n            LimitInWatts: powerCapValue\n          }\n        }]\n      };\n      return await api.patch(state.powerCapUri, data).then(() => i18n.global.t('pageServerPowerOperations.toast.successSaveSettings')).catch(error => {\n        console.log(error);\n        throw new Error(i18n.global.t('pageServerPowerOperations.toast.errorSaveSettings'));\n      });\n    }\n  }\n};\nexport default PowerControlStore;","map":{"version":3,"names":["api","i18n","PowerControlStore","namespaced","state","powerCapValue","powerCapUri","powerConsumptionValue","getters","mutations","setPowerCapValue","setPowerCapUri","setPowerConsumptionValue","actions","setPowerCapUpdatedValue","commit","value","getChassisCollection","get","then","response","data","Chassis","Members","map","member","catch","error","console","log","getPowerControl","dispatch","collection","length","Power","powerControl","PowerControl","powerCap","PowerLimit","LimitInWatts","powerConsumption","PowerConsumedWatts","setPowerControl","patch","global","t","Error"],"sources":["/home/zenchenko/openbmc/build/evb-ast2500/workspace/sources/webui-vue/src/store/modules/ResourceManagement/PowerControlStore.js"],"sourcesContent":["import api from '@/store/api';\nimport i18n from '@/i18n';\n\nconst PowerControlStore = {\n  namespaced: true,\n  state: {\n    powerCapValue: null,\n    powerCapUri: '',\n    powerConsumptionValue: null,\n  },\n  getters: {\n    powerCapValue: (state) => state.powerCapValue,\n    powerCapUri: (state) => state.powerCapUri,\n    powerConsumptionValue: (state) => state.powerConsumptionValue,\n  },\n  mutations: {\n    setPowerCapValue: (state, powerCapValue) =>\n      (state.powerCapValue = powerCapValue),\n    setPowerCapUri: (state, powerCapUri) => (state.powerCapUri = powerCapUri),\n    setPowerConsumptionValue: (state, powerConsumptionValue) =>\n      (state.powerConsumptionValue = powerConsumptionValue),\n  },\n  actions: {\n    setPowerCapUpdatedValue({ commit }, value) {\n      commit('setPowerCapValue', value);\n    },\n    async getChassisCollection() {\n      return await api\n        .get('/redfish/v1/')\n        .then((response) => api.get(response.data.Chassis['@odata.id']))\n        .then(({ data: { Members } }) =>\n          Members.map((member) => member['@odata.id']),\n        )\n        .catch((error) => console.log(error));\n    },\n    async getPowerControl({ dispatch, commit }) {\n      const collection = await dispatch('getChassisCollection');\n      if (!collection || collection.length === 0) return;\n      return await api\n        .get(`${collection[0]}`)\n        .then((response) => api.get(response.data.Power['@odata.id']))\n        .then((response) => {\n          const powerControl = response.data.PowerControl;\n          if (!powerControl || powerControl.length === 0) return;\n          const powerCapUri = response.data['@odata.id'];\n          const powerCap = powerControl[0].PowerLimit.LimitInWatts;\n          // If system is powered off, power consumption does not exist in the PowerControl\n          const powerConsumption = powerControl[0].PowerConsumedWatts || null;\n          commit('setPowerCapUri', powerCapUri);\n          commit('setPowerCapValue', powerCap);\n          commit('setPowerConsumptionValue', powerConsumption);\n        })\n        .catch((error) => {\n          console.log('Power control', error);\n        });\n    },\n    async setPowerControl({ state }, powerCapValue) {\n      const data = {\n        PowerControl: [{ PowerLimit: { LimitInWatts: powerCapValue } }],\n      };\n      return await api\n        .patch(state.powerCapUri, data)\n        .then(() =>\n          i18n.global.t('pageServerPowerOperations.toast.successSaveSettings'),\n        )\n        .catch((error) => {\n          console.log(error);\n          throw new Error(\n            i18n.global.t('pageServerPowerOperations.toast.errorSaveSettings'),\n          );\n        });\n    },\n  },\n};\n\nexport default PowerControlStore;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}