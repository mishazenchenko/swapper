{"ast":null,"code":"import \"core-js/modules/es.regexp.flags.js\";\nimport \"core-js/modules/esnext.typed-array.to-reversed.js\";\nimport \"core-js/modules/esnext.typed-array.to-sorted.js\";\nimport \"core-js/modules/esnext.typed-array.with.js\";\n/* handshake flags */\nconst NBD_FLAG_FIXED_NEWSTYLE = 0x1;\nconst NBD_FLAG_NO_ZEROES = 0x2;\n\n/* transmission flags */\nconst NBD_FLAG_HAS_FLAGS = 0x1;\nconst NBD_FLAG_READ_ONLY = 0x2;\n\n/* option negotiation */\nconst NBD_OPT_EXPORT_NAME = 0x1;\nconst NBD_REP_FLAG_ERROR = 0x1 << 31;\nconst NBD_REP_ERR_UNSUP = NBD_REP_FLAG_ERROR | 1;\n\n/* command definitions */\nconst NBD_CMD_READ = 0;\nconst NBD_CMD_WRITE = 1;\nconst NBD_CMD_DISC = 2;\nconst NBD_CMD_TRIM = 4;\n\n/* errno */\nconst EPERM = 1;\nconst EIO = 5;\nconst EINVAL = 22;\nconst ENOSPC = 28;\n\n/* internal object state */\nconst NBD_STATE_UNKNOWN = 1;\nconst NBD_STATE_OPEN = 2;\nconst NBD_STATE_WAIT_CFLAGS = 3;\nconst NBD_STATE_WAIT_OPTION = 4;\nconst NBD_STATE_TRANSMISSION = 5;\nexport default class NBDServer {\n  constructor(endpoint, file, id, token) {\n    this.socketStarted = () => {};\n    this.socketClosed = () => {};\n    this.errorReadingFile = () => {};\n    this.file = file;\n    this.id = id;\n    this.endpoint = endpoint;\n    this.ws = null;\n    this.state = NBD_STATE_UNKNOWN;\n    this.msgbuf = null;\n    this.start = function () {\n      this.ws = new WebSocket(this.endpoint, [token]);\n      this.state = NBD_STATE_OPEN;\n      this.ws.binaryType = 'arraybuffer';\n      this.ws.onmessage = this._on_ws_message.bind(this);\n      this.ws.onopen = this._on_ws_open.bind(this);\n      this.ws.onclose = this._on_ws_close.bind(this);\n      this.ws.onerror = this._on_ws_error.bind(this);\n      this.socketStarted();\n    };\n    this.stop = function () {\n      if (this.ws.readyState == 1) {\n        this.ws.close();\n        this.state = NBD_STATE_UNKNOWN;\n      }\n    };\n    this._on_ws_error = function (ev) {\n      console.log(`${endpoint} error: ${ev.error}`);\n      console.log(JSON.stringify(ev));\n    };\n    this._on_ws_close = function (ev) {\n      console.log(`${endpoint} closed with code: ${ev.code} + reason: ${ev.reason}`);\n      console.log(JSON.stringify(ev));\n      this.socketClosed(ev.code);\n    };\n    /* websocket event handlers */\n    this._on_ws_open = function () {\n      console.log(endpoint + ' opened');\n      this.client = {\n        flags: 0\n      };\n      this._negotiate();\n    };\n    this._on_ws_message = function (ev) {\n      var data = ev.data;\n      if (this.msgbuf == null) {\n        this.msgbuf = data;\n      } else {\n        const tmp = new Uint8Array(this.msgbuf.byteLength + data.byteLength);\n        tmp.set(new Uint8Array(this.msgbuf), 0);\n        tmp.set(new Uint8Array(data), this.msgbuf.byteLength);\n        this.msgbuf = tmp.buffer;\n      }\n      for (;;) {\n        var handler = this.recv_handlers[this.state];\n        if (!handler) {\n          console.log('no handler for state ' + this.state);\n          this.stop();\n          break;\n        }\n        var consumed = handler(this.msgbuf);\n        if (consumed < 0) {\n          console.log('handler[state=' + this.state + '] returned error ' + consumed);\n          this.stop();\n          break;\n        }\n        if (consumed == 0) {\n          break;\n        }\n        if (consumed > 0) {\n          if (consumed == this.msgbuf.byteLength) {\n            this.msgbuf = null;\n            break;\n          }\n          this.msgbuf = this.msgbuf.slice(consumed);\n        }\n      }\n    };\n    this._negotiate = function () {\n      var buf = new ArrayBuffer(18);\n      var data = new DataView(buf, 0, 18);\n      /* NBD magic: NBDMAGIC */\n      data.setUint32(0, 0x4e42444d);\n      data.setUint32(4, 0x41474943);\n      /* newstyle negotiation: IHAVEOPT */\n      data.setUint32(8, 0x49484156);\n      data.setUint32(12, 0x454f5054);\n      /* flags: fixed newstyle negotiation, no padding */\n      data.setUint16(16, NBD_FLAG_FIXED_NEWSTYLE | NBD_FLAG_NO_ZEROES);\n      this.state = NBD_STATE_WAIT_CFLAGS;\n      this.ws.send(buf);\n    };\n    /* handlers */\n    this._handle_cflags = function (buf) {\n      if (buf.byteLength < 4) {\n        return 0;\n      }\n      var data = new DataView(buf, 0, 4);\n      this.client.flags = data.getUint32(0);\n      this.state = NBD_STATE_WAIT_OPTION;\n      return 4;\n    };\n    this._handle_option = function (buf) {\n      if (buf.byteLength < 16) return 0;\n      var data = new DataView(buf, 0, 16);\n      if (data.getUint32(0) != 0x49484156 || data.getUint32(4) != 0x454f5054) {\n        console.log('invalid option magic');\n        return -1;\n      }\n      var opt = data.getUint32(8);\n      var len = data.getUint32(12);\n      if (buf.byteLength < 16 + len) {\n        return 0;\n      }\n      switch (opt) {\n        case NBD_OPT_EXPORT_NAME:\n          var n = 10;\n          if (!(this.client.flags & NBD_FLAG_NO_ZEROES)) n += 124;\n          var resp = new ArrayBuffer(n);\n          var view = new DataView(resp, 0, 10);\n          /* export size. */\n          var size = this.file.size;\n          // eslint-disable-next-line prettier/prettier\n          view.setUint32(0, Math.floor(size / 2 ** 32));\n          view.setUint32(4, size & 0xffffffff);\n          /* transmission flags: read-only */\n          view.setUint16(8, NBD_FLAG_HAS_FLAGS | NBD_FLAG_READ_ONLY);\n          this.ws.send(resp);\n          this.state = NBD_STATE_TRANSMISSION;\n          break;\n        default:\n          console.log('handle_option: Unsupported option: ' + opt);\n          /* reject other options */\n          var resp1 = new ArrayBuffer(20);\n          var view1 = new DataView(resp1, 0, 20);\n          view1.setUint32(0, 0x0003e889);\n          view1.setUint32(4, 0x045565a9);\n          view1.setUint32(8, opt);\n          view1.setUint32(12, NBD_REP_ERR_UNSUP);\n          view1.setUint32(16, 0);\n          this.ws.send(resp1);\n      }\n      return 16 + len;\n    };\n    this._create_cmd_response = function (req, rc, data = null) {\n      var len = 16;\n      if (data) len += data.byteLength;\n      var resp = new ArrayBuffer(len);\n      var view = new DataView(resp, 0, 16);\n      view.setUint32(0, 0x67446698);\n      view.setUint32(4, rc);\n      view.setUint32(8, req.handle_msB);\n      view.setUint32(12, req.handle_lsB);\n      if (data) new Uint8Array(resp, 16).set(new Uint8Array(data));\n      return resp;\n    };\n    this._handle_cmd = function (buf) {\n      if (buf.byteLength < 28) {\n        return 0;\n      }\n      var view = new DataView(buf, 0, 28);\n      if (view.getUint32(0) != 0x25609513) {\n        console.log('invalid request magic');\n        return -1;\n      }\n      var req = {\n        flags: view.getUint16(4),\n        type: view.getUint16(6),\n        handle_msB: view.getUint32(8),\n        handle_lsB: view.getUint32(12),\n        offset_msB: view.getUint32(16),\n        offset_lsB: view.getUint32(20),\n        length: view.getUint32(24)\n      };\n      /* we don't support writes, so nothing needs the data at present */\n      /* req.data = buf.slice(28); */\n      var err = 0;\n      var consumed = 28;\n      /* the command handlers return 0 on success, and send their\n       * own response. Otherwise, a non-zero error code will be\n       * used as a simple error response\n       */\n      switch (req.type) {\n        case NBD_CMD_READ:\n          err = this._handle_cmd_read(req);\n          break;\n        case NBD_CMD_DISC:\n          err = this._handle_cmd_disconnect(req);\n          break;\n        case NBD_CMD_WRITE:\n          /* we also need length bytes of data to consume a write\n           * request */\n          if (buf.byteLength < 28 + req.length) {\n            return 0;\n          }\n          consumed += req.length;\n          err = EPERM;\n          break;\n        case NBD_CMD_TRIM:\n          err = EPERM;\n          break;\n        default:\n          console.log('invalid command 0x' + req.type.toString(16));\n          err = EINVAL;\n      }\n      if (err) {\n        console.log('error handle_cmd: ' + err);\n        var resp = this._create_cmd_response(req, err);\n        this.ws.send(resp);\n        if (err == ENOSPC) {\n          this.errorReadingFile();\n          this.stop();\n        }\n      }\n      return consumed;\n    };\n    this._handle_cmd_read = function (req) {\n      var offset;\n      // eslint-disable-next-line prettier/prettier\n      offset = req.offset_msB * 2 ** 32 + req.offset_lsB;\n      if (offset > Number.MAX_SAFE_INTEGER) return ENOSPC;\n      if (offset + req.length > Number.MAX_SAFE_INTEGER) return ENOSPC;\n      if (offset + req.length > file.size) return ENOSPC;\n      var blob = this.file.slice(offset, offset + req.length);\n      var reader = new FileReader();\n      reader.onload = function (ev) {\n        var reader = ev.target;\n        if (reader.readyState != FileReader.DONE) return;\n        var resp = this._create_cmd_response(req, 0, reader.result);\n        this.ws.send(resp);\n      }.bind(this);\n      reader.onerror = function (ev) {\n        var reader = ev.target;\n        console.log('error reading file: ' + reader.error);\n        var resp = this._create_cmd_response(req, EIO);\n        this.ws.send(resp);\n      }.bind(this);\n      reader.readAsArrayBuffer(blob);\n      return 0;\n    };\n    this._handle_cmd_disconnect = function () {\n      this.stop();\n      return 0;\n    };\n    this.recv_handlers = Object.freeze({\n      [NBD_STATE_WAIT_CFLAGS]: this._handle_cflags.bind(this),\n      [NBD_STATE_WAIT_OPTION]: this._handle_option.bind(this),\n      [NBD_STATE_TRANSMISSION]: this._handle_cmd.bind(this)\n    });\n  }\n}","map":{"version":3,"names":["NBD_FLAG_FIXED_NEWSTYLE","NBD_FLAG_NO_ZEROES","NBD_FLAG_HAS_FLAGS","NBD_FLAG_READ_ONLY","NBD_OPT_EXPORT_NAME","NBD_REP_FLAG_ERROR","NBD_REP_ERR_UNSUP","NBD_CMD_READ","NBD_CMD_WRITE","NBD_CMD_DISC","NBD_CMD_TRIM","EPERM","EIO","EINVAL","ENOSPC","NBD_STATE_UNKNOWN","NBD_STATE_OPEN","NBD_STATE_WAIT_CFLAGS","NBD_STATE_WAIT_OPTION","NBD_STATE_TRANSMISSION","NBDServer","constructor","endpoint","file","id","token","socketStarted","socketClosed","errorReadingFile","ws","state","msgbuf","start","WebSocket","binaryType","onmessage","_on_ws_message","bind","onopen","_on_ws_open","onclose","_on_ws_close","onerror","_on_ws_error","stop","readyState","close","ev","console","log","error","JSON","stringify","code","reason","client","flags","_negotiate","data","tmp","Uint8Array","byteLength","set","buffer","handler","recv_handlers","consumed","slice","buf","ArrayBuffer","DataView","setUint32","setUint16","send","_handle_cflags","getUint32","_handle_option","opt","len","n","resp","view","size","Math","floor","resp1","view1","_create_cmd_response","req","rc","handle_msB","handle_lsB","_handle_cmd","getUint16","type","offset_msB","offset_lsB","length","err","_handle_cmd_read","_handle_cmd_disconnect","toString","offset","Number","MAX_SAFE_INTEGER","blob","reader","FileReader","onload","target","DONE","result","readAsArrayBuffer","Object","freeze"],"sources":["/home/zenchenko/openbmc/build/evb-ast2500/workspace/sources/webui-vue/src/utilities/NBDServer.js"],"sourcesContent":["/* handshake flags */\nconst NBD_FLAG_FIXED_NEWSTYLE = 0x1;\nconst NBD_FLAG_NO_ZEROES = 0x2;\n\n/* transmission flags */\nconst NBD_FLAG_HAS_FLAGS = 0x1;\nconst NBD_FLAG_READ_ONLY = 0x2;\n\n/* option negotiation */\nconst NBD_OPT_EXPORT_NAME = 0x1;\nconst NBD_REP_FLAG_ERROR = 0x1 << 31;\nconst NBD_REP_ERR_UNSUP = NBD_REP_FLAG_ERROR | 1;\n\n/* command definitions */\nconst NBD_CMD_READ = 0;\nconst NBD_CMD_WRITE = 1;\nconst NBD_CMD_DISC = 2;\nconst NBD_CMD_TRIM = 4;\n\n/* errno */\nconst EPERM = 1;\nconst EIO = 5;\nconst EINVAL = 22;\nconst ENOSPC = 28;\n\n/* internal object state */\nconst NBD_STATE_UNKNOWN = 1;\nconst NBD_STATE_OPEN = 2;\nconst NBD_STATE_WAIT_CFLAGS = 3;\nconst NBD_STATE_WAIT_OPTION = 4;\nconst NBD_STATE_TRANSMISSION = 5;\n\nexport default class NBDServer {\n  constructor(endpoint, file, id, token) {\n    this.socketStarted = () => {};\n    this.socketClosed = () => {};\n    this.errorReadingFile = () => {};\n    this.file = file;\n    this.id = id;\n    this.endpoint = endpoint;\n    this.ws = null;\n    this.state = NBD_STATE_UNKNOWN;\n    this.msgbuf = null;\n    this.start = function () {\n      this.ws = new WebSocket(this.endpoint, [token]);\n      this.state = NBD_STATE_OPEN;\n      this.ws.binaryType = 'arraybuffer';\n      this.ws.onmessage = this._on_ws_message.bind(this);\n      this.ws.onopen = this._on_ws_open.bind(this);\n      this.ws.onclose = this._on_ws_close.bind(this);\n      this.ws.onerror = this._on_ws_error.bind(this);\n      this.socketStarted();\n    };\n    this.stop = function () {\n      if (this.ws.readyState == 1) {\n        this.ws.close();\n        this.state = NBD_STATE_UNKNOWN;\n      }\n    };\n    this._on_ws_error = function (ev) {\n      console.log(`${endpoint} error: ${ev.error}`);\n      console.log(JSON.stringify(ev));\n    };\n    this._on_ws_close = function (ev) {\n      console.log(\n        `${endpoint} closed with code: ${ev.code} + reason: ${ev.reason}`,\n      );\n      console.log(JSON.stringify(ev));\n      this.socketClosed(ev.code);\n    };\n    /* websocket event handlers */\n    this._on_ws_open = function () {\n      console.log(endpoint + ' opened');\n      this.client = {\n        flags: 0,\n      };\n      this._negotiate();\n    };\n    this._on_ws_message = function (ev) {\n      var data = ev.data;\n      if (this.msgbuf == null) {\n        this.msgbuf = data;\n      } else {\n        const tmp = new Uint8Array(this.msgbuf.byteLength + data.byteLength);\n        tmp.set(new Uint8Array(this.msgbuf), 0);\n        tmp.set(new Uint8Array(data), this.msgbuf.byteLength);\n        this.msgbuf = tmp.buffer;\n      }\n      for (;;) {\n        var handler = this.recv_handlers[this.state];\n        if (!handler) {\n          console.log('no handler for state ' + this.state);\n          this.stop();\n          break;\n        }\n        var consumed = handler(this.msgbuf);\n        if (consumed < 0) {\n          console.log(\n            'handler[state=' + this.state + '] returned error ' + consumed,\n          );\n          this.stop();\n          break;\n        }\n        if (consumed == 0) {\n          break;\n        }\n        if (consumed > 0) {\n          if (consumed == this.msgbuf.byteLength) {\n            this.msgbuf = null;\n            break;\n          }\n          this.msgbuf = this.msgbuf.slice(consumed);\n        }\n      }\n    };\n    this._negotiate = function () {\n      var buf = new ArrayBuffer(18);\n      var data = new DataView(buf, 0, 18);\n      /* NBD magic: NBDMAGIC */\n      data.setUint32(0, 0x4e42444d);\n      data.setUint32(4, 0x41474943);\n      /* newstyle negotiation: IHAVEOPT */\n      data.setUint32(8, 0x49484156);\n      data.setUint32(12, 0x454f5054);\n      /* flags: fixed newstyle negotiation, no padding */\n      data.setUint16(16, NBD_FLAG_FIXED_NEWSTYLE | NBD_FLAG_NO_ZEROES);\n      this.state = NBD_STATE_WAIT_CFLAGS;\n      this.ws.send(buf);\n    };\n    /* handlers */\n    this._handle_cflags = function (buf) {\n      if (buf.byteLength < 4) {\n        return 0;\n      }\n      var data = new DataView(buf, 0, 4);\n      this.client.flags = data.getUint32(0);\n      this.state = NBD_STATE_WAIT_OPTION;\n      return 4;\n    };\n    this._handle_option = function (buf) {\n      if (buf.byteLength < 16) return 0;\n      var data = new DataView(buf, 0, 16);\n      if (data.getUint32(0) != 0x49484156 || data.getUint32(4) != 0x454f5054) {\n        console.log('invalid option magic');\n        return -1;\n      }\n      var opt = data.getUint32(8);\n      var len = data.getUint32(12);\n      if (buf.byteLength < 16 + len) {\n        return 0;\n      }\n      switch (opt) {\n        case NBD_OPT_EXPORT_NAME:\n          var n = 10;\n          if (!(this.client.flags & NBD_FLAG_NO_ZEROES)) n += 124;\n          var resp = new ArrayBuffer(n);\n          var view = new DataView(resp, 0, 10);\n          /* export size. */\n          var size = this.file.size;\n          // eslint-disable-next-line prettier/prettier\n          view.setUint32(0, Math.floor(size / (2 ** 32)));\n          view.setUint32(4, size & 0xffffffff);\n          /* transmission flags: read-only */\n          view.setUint16(8, NBD_FLAG_HAS_FLAGS | NBD_FLAG_READ_ONLY);\n          this.ws.send(resp);\n          this.state = NBD_STATE_TRANSMISSION;\n          break;\n        default:\n          console.log('handle_option: Unsupported option: ' + opt);\n          /* reject other options */\n          var resp1 = new ArrayBuffer(20);\n          var view1 = new DataView(resp1, 0, 20);\n          view1.setUint32(0, 0x0003e889);\n          view1.setUint32(4, 0x045565a9);\n          view1.setUint32(8, opt);\n          view1.setUint32(12, NBD_REP_ERR_UNSUP);\n          view1.setUint32(16, 0);\n          this.ws.send(resp1);\n      }\n      return 16 + len;\n    };\n    this._create_cmd_response = function (req, rc, data = null) {\n      var len = 16;\n      if (data) len += data.byteLength;\n      var resp = new ArrayBuffer(len);\n      var view = new DataView(resp, 0, 16);\n      view.setUint32(0, 0x67446698);\n      view.setUint32(4, rc);\n      view.setUint32(8, req.handle_msB);\n      view.setUint32(12, req.handle_lsB);\n      if (data) new Uint8Array(resp, 16).set(new Uint8Array(data));\n      return resp;\n    };\n    this._handle_cmd = function (buf) {\n      if (buf.byteLength < 28) {\n        return 0;\n      }\n      var view = new DataView(buf, 0, 28);\n      if (view.getUint32(0) != 0x25609513) {\n        console.log('invalid request magic');\n        return -1;\n      }\n      var req = {\n        flags: view.getUint16(4),\n        type: view.getUint16(6),\n        handle_msB: view.getUint32(8),\n        handle_lsB: view.getUint32(12),\n        offset_msB: view.getUint32(16),\n        offset_lsB: view.getUint32(20),\n        length: view.getUint32(24),\n      };\n      /* we don't support writes, so nothing needs the data at present */\n      /* req.data = buf.slice(28); */\n      var err = 0;\n      var consumed = 28;\n      /* the command handlers return 0 on success, and send their\n       * own response. Otherwise, a non-zero error code will be\n       * used as a simple error response\n       */\n      switch (req.type) {\n        case NBD_CMD_READ:\n          err = this._handle_cmd_read(req);\n          break;\n        case NBD_CMD_DISC:\n          err = this._handle_cmd_disconnect(req);\n          break;\n        case NBD_CMD_WRITE:\n          /* we also need length bytes of data to consume a write\n           * request */\n          if (buf.byteLength < 28 + req.length) {\n            return 0;\n          }\n          consumed += req.length;\n          err = EPERM;\n          break;\n        case NBD_CMD_TRIM:\n          err = EPERM;\n          break;\n        default:\n          console.log('invalid command 0x' + req.type.toString(16));\n          err = EINVAL;\n      }\n      if (err) {\n        console.log('error handle_cmd: ' + err);\n        var resp = this._create_cmd_response(req, err);\n        this.ws.send(resp);\n        if (err == ENOSPC) {\n          this.errorReadingFile();\n          this.stop();\n        }\n      }\n      return consumed;\n    };\n    this._handle_cmd_read = function (req) {\n      var offset;\n      // eslint-disable-next-line prettier/prettier\n      offset = (req.offset_msB * 2 ** 32) + req.offset_lsB;\n      if (offset > Number.MAX_SAFE_INTEGER) return ENOSPC;\n      if (offset + req.length > Number.MAX_SAFE_INTEGER) return ENOSPC;\n      if (offset + req.length > file.size) return ENOSPC;\n      var blob = this.file.slice(offset, offset + req.length);\n      var reader = new FileReader();\n\n      reader.onload = function (ev) {\n        var reader = ev.target;\n        if (reader.readyState != FileReader.DONE) return;\n        var resp = this._create_cmd_response(req, 0, reader.result);\n        this.ws.send(resp);\n      }.bind(this);\n\n      reader.onerror = function (ev) {\n        var reader = ev.target;\n        console.log('error reading file: ' + reader.error);\n        var resp = this._create_cmd_response(req, EIO);\n        this.ws.send(resp);\n      }.bind(this);\n      reader.readAsArrayBuffer(blob);\n      return 0;\n    };\n    this._handle_cmd_disconnect = function () {\n      this.stop();\n      return 0;\n    };\n    this.recv_handlers = Object.freeze({\n      [NBD_STATE_WAIT_CFLAGS]: this._handle_cflags.bind(this),\n      [NBD_STATE_WAIT_OPTION]: this._handle_option.bind(this),\n      [NBD_STATE_TRANSMISSION]: this._handle_cmd.bind(this),\n    });\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}